---
title: "Diego Perdomo - Futuro Media"
output: html_document
date: "2025-04-22"
editor_options: 
  markdown: 
    wrap: 72
---

# Pitch

In May, federal courts permitted immigration agencies to access
confidential, personal information of up to 7 million undocumented
immigrant taxpayers. This is the first instance where the Internal
Revenue Service has shared confidential information for the purposes of
immigration investigation, according to the National Immigration Forum.

Since 1996, the IRS has permitted people with noncitizen status to file
their taxes through the Individual Taxpayer Identification Number. The
identification number, which permitted undocumented immigrants to file
their taxes and receive select tax credits, fell under scrutiny in
recent federal court hearings and prompted the landmark collaboration
between the Department of Homeland Security and Department of Treasury.

With new questions of undocumented immigrant’s relationship to taxes, I
think it would be timely and relevant to Futuro’s audience to
investigate:

-   How undocumented taxpayer contributions differ in makeup from
    citizen taxpayers

    -   The portfolio of taxes undocumented immigrants contribute
        compared to the U.S. total of tax revenue (grouped bar chart
        with a stacked bar to show how percentages would be if
        undocumented immigrants filed with legal status)

-   The impact of the current undocumented tax contributions **#rsw
    comment: great but let's clarify - so undocumented people contribute
    \$100 bln to the economy? \#**

    -   With nearly 11 million estimated undocumented immigrants, the
        U.S. sees nearly \$100 billion in tax contributions to federal
        social programs that do not return to undocumented taxpayers

-   Which states receive the most in specific taxes like sales and
    income

    -   Are per capita tax rates higher than citizen per capita tax
        rates in specific states?

Given the missing data on the exact counts of undocumented immigrants,
it would be interesting to examine:

-   How other tax policy think tanks measure immigrant contributions

    -   Particularly the methodology of these studies and what
        assumptions they make from the holes in their data.

-   Other instances of immigrant contribution to federal, state and
    local revenue

    -   Commerce and census data pertaining to income and nativity

Through this research, I intend to add new comparisons to data that has
been discussed among spaces that report on immigrants and taxes for
almost 11 months. **#rsw comment: cut, make this project focused on your
own work**

This notebook helps you get started by extracting data from Table 1 of
this report: <https://itep.org/undocumented-immigrants-taxes-2024/>

# Load software libraries

```{r}
#install.packages("tidyverse")
#install.packages("janitor")
#install.packages("readxl")
#install.packages("rvest")
library(tidyverse)
library(janitor)
library(readxl)
library(rvest)
library(DT)
```

The Institute on Economic Policy estimates of 11 million undocumented
immigrants in the U.S.

Contributing almost 100 billion in taxes

# Scrape a table from this website

<https://itep.org/undocumented-immigrants-taxes-2024/> APPENDIX TABLE 1.

#RSW comment: **Let's integrate the code better with the narrative.
Explain that this is a source of undocumented immigrant tax
contributions by various types. point out the top states by type (sales,
income, etc) and provide some details about patterns**

State and Local Tax Contributions by the Undocumented Immigrant
Population in 2022

```{r}
#State local tax contribs from undoc immigrants in 2022
# Read the HTML file from the URL
url <- "https://itep.org/undocumented-immigrants-taxes-2024/"
html <- read_html(url)

# Extract the relevant information using XPath
# I'll show you how to do this.
data <- html %>%
  html_nodes(xpath = "/html/body/div/div/div[2]/div/div[1]/div[1]/div[4]/table") %>%
  html_nodes("td") %>%
  html_text() %>%
  matrix(ncol = 7, byrow = TRUE) %>%
  as.data.frame(stringsAsFactors = FALSE)

# Assign column names

new_headers <- as.character(data[1, ])
data_clean <- data[-1, ] # Remove the first row
colnames(data_clean) <- new_headers
```

```{r}
#Undocumented immigrants population and income data, 2022
undoc_immigrant_income_pop <- html |> 
  html_nodes(xpath = "/html/body/div[1]/div/div[2]/div/div[1]/div[1]/div[8]/table") |> 
  html_nodes("td") |> 
  html_text() |> 
  matrix(ncol = 3, byrow = TRUE) |> 
  as.data.frame(stringsAsFactors = FALSE)

###Make top consistent
undoc_immigrant_income_pop_clean <- undoc_immigrant_income_pop 

colnames(undoc_immigrant_income_pop_clean) <-     undoc_immigrant_income_pop[1,]

undoc_immigrant_income_pop_clean <- undoc_immigrant_income_pop_clean[-1,]
rownames(undoc_immigrant_income_pop_clean) <- 1:nrow(undoc_immigrant_income_pop_clean)


```

# Cleaning

```{r}
#Cleaning state local tax contribs from undoc immigrants in 2022
data <- data_clean |> 
  clean_names() |> 
  #remove dollar signs
  mutate(
    sales_and_excise_taxes=as.numeric(parse_number(sales_and_excise_taxes)),
    property_taxes=as.numeric(parse_number(property_taxes)),
    personal_and_business_income_taxes=as.numeric(parse_number(personal_and_business_income_taxes)),
    other_taxes=as.numeric(parse_number(other_taxes)),
    total_state_and_local_taxes=as.numeric(parse_number(total_state_and_local_taxes)),
     effective_tax_rate=as.numeric(parse_number(effective_tax_rate)),
    )

write.csv(data, "../data/state_local_tax_undoc_2022.csv")

#Remember to credit the source in your articles: Institute on Taxation and Economic Policy
```

```{r}
#Cleaning undocumented immigrant population and income data
undoc_immigrant_income_pop <- undoc_immigrant_income_pop_clean |> 
  clean_names() |> 
  #remove dollar signs
  mutate(
    population=as.numeric(parse_number(population)),
    aggregate_income=as.numeric(parse_number(aggregate_income))
    )

write_csv(undoc_immigrant_income_pop, "../data/aggregate_income_undoc_2022.csv")

#Remember to credit the source in your articles: Institute on Taxation and Economic Policy
```

```{r}
# Load your data

# YOUR_DATA <- read.csv("../data/XXXXX.csv") |> 
#     clean_names()

# data <- read_excel("../data/2024-12-Revenue.xlsx", skip=2) |> 
#     clean_names()

```

Data details:

# Explore the data types

```{r}

#glimpse(YOUR_DATA)

glimpse(data)

```

# Code for later Fix dates

```{r}
# data <- data |> 
#   mutate(date = lubridate::mdy(contribution_date))
```

# Data exploration: taxes paid

## State and Local Taxes

```{r echo=F}
##Decending Totals
#Total State and Local 
data |> 
  select(state, total_state_and_local_taxes) |> 
  arrange(desc(total_state_and_local_taxes))
```

```{r}
#Total Sales Tax 
data |> 
  select(state, sales_and_excise_taxes) |> 
  arrange(desc(sales_and_excise_taxes))

#Total Property 
data |> 
  select(state, property_taxes) |> 
  arrange(desc(property_taxes))
```

```{r hide=T,}
#Per capita
undoc_immigrant_taxes_income <- inner_join(data, undoc_immigrant_income_pop, by = "state")

#Sales - likely dependent on sales tax rates and population
undoc_immigrant_taxes_income <- undoc_immigrant_taxes_income |> 
  mutate(sales_capita = sales_and_excise_taxes/population,
         property_capita = property_taxes/population,
         personal_and_business_income_capita = personal_and_business_income_taxes/population,
         other_capita = other_taxes/population,
         total_capita = total_state_and_local_taxes/population)

#Export and do visual analysis on datawrapper to visualize trends
write.csv(undoc_immigrant_taxes_income, "../data/taxes_capita_undoc_2022.csv")

datatable(undoc_immigrant_income_pop, caption = "HEADLINE", options = list(pageLength = 20)) 
```


<iframe title="NY undocumented workers top income tax rate" aria-label="Map" id="datawrapper-chart-6UITi" src="https://datawrapper.dwcdn.net/6UITi/5/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="400" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r,i=0;r=e[i];i++)if(r.contentWindow===a.source){var d=a.data["datawrapper-height"][t]+"px";r.style.height=d}}}))}();
</script>

```{r hide=T}
# Other Taxes by State
data |> 
  select(state, other_taxes) |> 
  arrange(desc(other_taxes))


```

```{r}
#data |> 
```

# Questions

Write down questions you want answered:

-   What is the per capita rate for tax totals per state. (tidycensus
    undocumented counts)?

-   Do states with favorable policies toward undocumented immigrants
    have friendly tax policies like rates (how will you define favorable
    policies)?

-   What are the other taxes undocumented immigrants pay and why do
    Californian undocumented immigrants pay almost 40% of nationwide
    other taxes.

# Data Details

You will want to read this article carefully and you will probably want
to scrape more data from it.
<https://itep.org/undocumented-immigrants-taxes-2024/>

A very good article about the issue
<https://unidosus.org/blog/2025/03/24/when-dhs-requests-itin-tax-data-why-every-american-should-be-concerned/>

Background on ITIN
<https://www.irs.gov/tin/itin/individual-taxpayer-identification-number-itin>
If you're a resident alien, nonresident alien or their spouse or
dependent, you can apply for an ITIN regardless of immigration status.

Resident alien or nonresident alien

If you're not a U.S. citizen, your tax status can be either:

Resident alien – If you were present in the U.S. for more than 183
days\* (substantial presence test) or you’re a lawful permanent resident
of the U.S. (green card test) Nonresident alien – If you don’t meet
either the green card or substantial presence test for resident alien
status. \*Special day-counting rules apply to certain foreign
government-related individuals, teachers, trainees and students who are
temporarily present in the U.S. under certain U.S. visas.

Determining your tax residency status

U.S. Tax Guide for Aliens, Publication 519
